(function(){self.JSREPLEngine=function(){function i(c,a,d,f,h,j){this.sandbox=h;this.virtual_machine=new this.sandbox.QBasic.VirtualMachine({print:a,input:c,result:d,error:f});j()}i.prototype.Eval=function(c){try{return this.virtual_machine.run(c,function(d){return function(){return d.virtual_machine.stack.length?d.virtual_machine.cons.result(d.virtual_machine.stack.pop().toString()):d.virtual_machine.cons.result("")}}(this))}catch(a){return this.virtual_machine.cons.error(a.message)}};i.prototype.EvalSync=
function(c){var a;a=null;this.virtual_machine.run(c,function(d){return function(){if(d.virtual_machine.stack.length)return a=d.virtual_machine.stack.pop()}}(this));return a};i.prototype.GetNextLineIndent=function(c){var a,d,f,h,j;this.sandbox.QBasic.Program.prototype.createParser();h=this.sandbox.QBasic.Program.parser;if(h.parse(c+"\n")===true)return false;j=h.tokenizer;f=function(){var a,h,g,b;g=c.split("\n");b=[];for(a=0,h=g.length;a<h;a++)d=g[a],b.push(d+"\n");return b}();a=function(a,d){var g,
b,e,c,f,i;d==null&&(d=false);b=[];for(f=0,i=a.length;f<i;f++)if(g=a[f],!h.parse(g))switch(j.setText(g),e=j.nextToken(0,0),g=e.text,e=j.nextToken(0,e.locus.position+e.text.length),e=e.text,c=b[b.length-1],g){case "SUB":case "FUNCTION":case "FOR":case "IF":case "SELECT":case "WHILE":b.push(g);break;case "DO":b.push(e==="WHILE"?"DOWHILE":"DO");break;case "ELSE":if(d&&b.length===0)b.push("IF");else if(c!=="IF")return-1;break;case "WEND":if(c==="WHILE")b.pop();else return-1;break;case "FOR":if(c==="NEXT")b.pop();
else return-1;break;case "LOOP":if(e==="WHILE"||e==="UNTIL")if(c==="DO")b.pop();else return-1;else if(c==="DOWHILE")b.pop();else return-1;break;case "END":if(c===e)b.pop();else return-1}return b.length};return a(f)<=0?false:a([f.slice(-1)[0]],true)>0?1:0};return i}()}).call(this);
